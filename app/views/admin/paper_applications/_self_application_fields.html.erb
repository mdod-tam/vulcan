<%# 
  Self Application Fields Partial
  Used when an adult is applying for themselves (not a dependent)
  
  This partial provides a complete applicant information form with:
  - Personal identification
  - Contact information with live feedback
  - Communication preferences
  - Accessibility options
%>

  <%= fields_for :constituent, @paper_application[:constituent] do |c| %>
    <%# ================================================================ %>
    <%# SECTION 1: Personal Identification %>
    <%# ================================================================ %>
    <div class="mb-6">
      <h3 class="text-base font-medium text-gray-800 mb-3 flex items-center gap-2">
        <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
        Personal Information
      </h3>
      
      <%# Row 1: Name fields %>
      <div class="grid grid-cols-6 gap-4 mb-4">
        <div class="col-span-6 sm:col-span-2">
          <%= c.label :first_name, "First Name", class: "block text-sm font-medium text-gray-700 required-label" %>
          <%= c.text_field :first_name, 
              required: true,
              autocomplete: "given-name",
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
              "aria-required": "true" %>
        </div>
        <div class="col-span-2 sm:col-span-1">
          <%= c.label :middle_initial, "M.I.", class: "block text-sm font-medium text-gray-700" %>
          <%= c.text_field :middle_initial, 
              maxlength: 1, 
              autocomplete: "additional-name",
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" %>
        </div>
        <div class="col-span-4 sm:col-span-3">
          <%= c.label :last_name, "Last Name", class: "block text-sm font-medium text-gray-700 required-label" %>
          <%= c.text_field :last_name, 
              required: true,
              autocomplete: "family-name",
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
              "aria-required": "true" %>
        </div>
      </div>
      
      <%# Row 2: Date of Birth %>
      <div class="mb-4">
        <%= c.label :date_of_birth, "Date of Birth", class: "block text-sm font-medium text-gray-700  required-label" %>
        <%= c.date_field :date_of_birth, 
            required: true,
            autocomplete: "bday",
            class: "mt-1 block w-full max-w-xs rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
            "aria-required": "true",
            max: Date.current.to_s %>
      </div>
    </div>

    <%# ================================================================ %>
    <%# SECTION 2 & 3: Contact Information and Communication Preferences with Live Feedback %>
    <%# ================================================================ %>
    <div data-controller="contact-feedback">
    
    <div class="mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
      <h3 class="text-base font-medium text-gray-800 mb-3 flex items-center gap-2">
        <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
        </svg>
        Contact Information
      </h3>
      
      <%# Email and Phone row %>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
          <%= c.label :email, "Email Address", class: "block text-sm font-medium text-gray-700 required-label" %>
          <%= c.email_field :email, 
              required: true,
              autocomplete: "email",
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
              "aria-required": "true",
              data: { "contact-feedback-target": "email" } %>
        </div>
        <div>
          <%= c.label :phone, "Phone Number", class: "block text-sm font-medium text-gray-700 required-label" %>
          <%= c.telephone_field :phone, 
              required: true,
              autocomplete: "tel",
              placeholder: "XXX-XXX-XXXX",
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
              "aria-required": "true",
              data: { "contact-feedback-target": "phone" } %>
        </div>
      </div>

      <%# Preferred Contact Method %>
      <fieldset class="mb-4">
        <legend class="text-sm font-medium text-gray-700 mb-2">How would you like us to contact you if we have any questions?</legend>
        <div class="flex flex-wrap gap-4">
          <div class="flex items-center">
            <%= c.radio_button :phone_type, "voice", 
                id: "constituent_phone_type_voice", 
                class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300",
                data: { action: "change->contact-feedback#updateFeedback" } %>
            <%= c.label :phone_type_voice, "Call me", for: "constituent_phone_type_voice", class: "ml-2 text-sm text-gray-700" %>
          </div>
          <div class="flex items-center">
            <%= c.radio_button :phone_type, "text", 
                id: "constituent_phone_type_text", 
                class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300",
                data: { action: "change->contact-feedback#updateFeedback" } %>
            <%= c.label :phone_type_text, "Text me", for: "constituent_phone_type_text", class: "ml-2 text-sm text-gray-700" %>
          </div>
          <div class="flex items-center">
            <%= c.radio_button :phone_type, "videophone", 
                id: "constituent_phone_type_videophone", 
                class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300",
                data: { action: "change->contact-feedback#updateFeedback" } %>
            <%= c.label :phone_type_videophone, "Call me using ASL (videophone)", for: "constituent_phone_type_videophone", class: "ml-2 text-sm text-gray-700" %>
          </div>
          <div class="flex items-center">
            <%= c.radio_button :phone_type, "email", 
                id: "constituent_phone_type_email", 
                class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300",
                data: { action: "change->contact-feedback#updateFeedback" } %>
            <%= c.label :phone_type_email, "Email me", for: "constituent_phone_type_email", class: "ml-2 text-sm text-gray-700" %>
          </div>
          <div class="flex items-center">
            <%= c.radio_button :phone_type, "letter", 
                id: "constituent_phone_type_letter", 
                class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300",
                data: { action: "change->contact-feedback#updateFeedback" } %>
            <%= c.label :phone_type_letter, "Send me a letter in the mail", for: "constituent_phone_type_letter", class: "ml-2 text-sm text-gray-700" %>
          </div>
        </div>
        <%# Live feedback for contact method %>
        <div data-contact-feedback-target="feedback" class="hidden" aria-live="polite" aria-atomic="true"></div>
      </fieldset>

      <%# Address fields %>
      <div class="space-y-4">
        <div>
          <%= c.label :physical_address_1, "Street Address", class: "block text-sm font-medium text-gray-700 required-label" %>
          <%= c.text_field :physical_address_1, 
              required: true,
              autocomplete: "address-line1",
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
              "aria-required": "true",
              data: { contact_feedback_target: "address1" } %>
        </div>
        <div>
          <%= c.label :physical_address_2, "Apartment, suite, unit, etc. (optional)", class: "block text-sm font-medium text-gray-700" %>
          <%= c.text_field :physical_address_2, 
              autocomplete: "address-line2",
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
              data: { contact_feedback_target: "address2" } %>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="col-span-2 md:col-span-2">
            <%= c.label :city, "City", class: "block text-sm font-medium text-gray-700 required-label" %>
            <%= c.text_field :city, 
                required: true,
                autocomplete: "address-level2",
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
                "aria-required": "true",
                data: { contact_feedback_target: "city" } %>
          </div>
          <div>
            <%= c.label :state, "State", class: "block text-sm font-medium text-gray-700 required-label" %>
            <%= c.text_field :state, 
                value: "MD", 
                required: true,
                autocomplete: "address-level1",
                data: { contact_feedback_target: "state" },
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
                "aria-required": "true" %>
          </div>
          <div>
            <%= c.label :zip_code, "ZIP Code", class: "block text-sm font-medium text-gray-700 required-label" %>
            <%= c.text_field :zip_code, 
                required: true,
                autocomplete: "postal-code",
                data: { contact_feedback_target: "zipCode" },
                pattern: "[0-9]{5}(-[0-9]{4})?",
                placeholder: "12345 or 12345-6789",
                "aria-describedby": "zip_format_hint",
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
                "aria-required": "true" %>
            <p id="zip_format_hint" class="mt-1 text-xs text-gray-500">5 digits or 5 digits-4 digits</p>
          </div>
        </div>
        <%# Residency proof notice - placed after all address fields for clarity %>
        <div role="note" aria-label="Address matching requirement" class="mt-3 flex items-start gap-2 p-2 bg-blue-50 border border-blue-200 rounded-md">
          <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
          <p class="text-sm text-blue-800">
            <strong>Important:</strong> This address must match the address on your residency proof document.
          </p>
        </div>
      </div>
    </div>

    <%# ================================================================ %>
    <%# SECTION 3: Communication & Accessibility Preferences %>
    <%# ================================================================ %>
    <div class="mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-100">
      <h3 class="text-base font-medium text-gray-800 mb-4 flex items-center gap-2">
        <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
        </svg>
        Communication Preferences
      </h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <%# Language Preference %>
        <div>
          <%= c.label :locale, "Preferred Language", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= c.select :locale, 
              options_for_select([
                ["English", "en"], 
                ["Spanish", "es"], 
                ["French", "fr"], 
                ["American Sign Language (ASL)", "asl"],
                ["Other", "other"]
              ], c.object&.locale || "en"), 
              { prompt: "Select Language" }, 
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" %>
        </div>

        <%# Preferred Communication Method (ASL, Written, etc.) %>
        <div>
          <%= c.label :preferred_means_of_communication, "How do you prefer to communicate?", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= c.select :preferred_means_of_communication, 
              options_for_select([
                ["Voice (spoken language)", "voice"],
                ["Read lips", "lip_reading"],
                ["American Sign Language (ASL)", "asl"],
                ["Signed English", "signed_english"],
                ["Written notes", "written"],
                ["Typed communication", "typed"],
                ["Braille", "braille"],
                ["Augmentative & Alternative Communication (AAC)", "aac"]
              ], c.object&.preferred_means_of_communication), 
              { prompt: "Select preference", include_blank: false }, 
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
              "aria-describedby": "comm_method_hint" %>
          <p id="comm_method_hint" class="mt-1 text-xs text-gray-500">This helps us communicate with you in your preferred way</p>
        </div>
      </div>

      <%# Official Document Delivery Preference %>
      <fieldset class="mt-6 p-4 bg-blue-50 border-2 border-blue-200 rounded-lg">
        <legend class="text-base font-semibold text-blue-900 mb-1 px-2">
          Where should we send official program documents?
        </legend>
        <p class="text-sm text-blue-700 mb-3 px-2">
          Important notices, approval letters, and voucher information will be delivered here
        </p>
        <div class="flex flex-wrap gap-6">
          <div class="flex items-start">
            <%= c.radio_button :communication_preference, "email", 
                id: "constituent_communication_preference_email", 
                checked: true,
                class: "mt-1 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300",
                data: { action: "change->contact-feedback#updateDeliveryFeedback" } %>
            <label for="constituent_communication_preference_email" class="ml-2">
              <span class="block text-sm font-medium text-gray-700">Email</span>
              <span class="block text-xs text-gray-500">Faster delivery, easy to save</span>
            </label>
          </div>
          <div class="flex items-start">
            <%= c.radio_button :communication_preference, "letter", 
                id: "constituent_communication_preference_letter", 
                class: "mt-1 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300",
                data: { action: "change->contact-feedback#updateDeliveryFeedback" } %>
            <label for="constituent_communication_preference_letter" class="ml-2">
              <span class="block text-sm font-medium text-gray-700">Printed letter by mail</span>
              <span class="block text-xs text-gray-500">Physical copy to your address</span>
            </label>
          </div>
        </div>
        <%# Live feedback for delivery method %>
        <div data-contact-feedback-target="deliveryFeedback" class="hidden" aria-live="polite" aria-atomic="true"></div>
      </fieldset>
    </div>
    
    </div><%# End contact-feedback controller scope %>

    <%# ================================================================ %>
    <%# SECTION 4: How Did You Hear About Us %>
    <%# ================================================================ %>
    <div class="mb-4">
      <%= c.label :referral_source, "How did you hear about the MAT Program?", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= c.select :referral_source, 
          options_for_select([
            ["Medical provider / Doctor's office", "medical_provider"],
            ["Social worker / Case manager", "social_worker"],
            ["State agency (DORS, MDOD, etc.)", "state_agency"],
            ["Community organization", "community_org"],
            ["Friend or family member", "friend_family"],
            ["Internet search", "internet"],
            ["Social media", "social_media"],
            ["Other", "other"]
          ], c.object&.referral_source), 
          { prompt: "Select an option (optional)", include_blank: true }, 
          class: "mt-1 block w-full rounded-md border-gray-300 bg-white shadow-sm ring-1 ring-inset ring-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 sm:text-sm" %>
    </div>
  <% end %>
